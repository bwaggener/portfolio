---
title: "Portfolio 3"
---

The goal of this project is to run a regression analysis on pilot data i collected for my thesis project. I think i may break this up into several portfolios eventually but i need this all here for now.


```{r load-packages, message=FALSE}
library(tidyverse) 
library(tidyr)
library(dplyr)
library(lme4)
library(MuMIn)

```

```{r cleaneddata}

ideal_society <- read.csv("C:\\Users\\Ben\\OneDrive\\Documents\\01Wake Forest\\2025SpringDataScience\\IdealSocietyData\\RRRPILOT_IdealSocietiesConservative Values_February 10, 2025_07.27.csv")

ideal_society$StartDate <- as.POSIXct(ideal_society$StartDate, format="%Y-%m-%d %H:%M:%S", tz="UTC")


ideal_society_real_data <- ideal_society %>%
  filter(as.Date(StartDate)=="2025-01-28") %>%
  filter(Progress != 14)

ideal_society_clean <- ideal_society_real_data %>%
  filter(Q127 != 5)

politicalorientation_data <- read.csv("C:\\Users\\Ben\\OneDrive\\Documents\\01Wake Forest\\2025SpringDataScience\\IdealSocietyData\\CopyMergefile.csv")

ideal_society_clean <- ideal_society_clean %>%
  left_join(politicalorientation_data, by = "PROLIFIC_PID")
  
ideal_society_clean <- ideal_society_clean %>%
  rename (poli_ori = PROLIFIC_Political.spectrum..us.)

ideal_society_clean <- ideal_society_clean %>%
  rename(LILH = Q7) %>%
  rename(LIHH = Q4) %>%
  rename(HILH = Q6) %>%
  rename(HIHH = Q5) %>%
  rename(LFLH = Q8) %>%
  rename(LFHH = Q124) %>%
  rename(HFLH = Q125) %>%
  rename(HFHH = Q126) %>%
  rename(LRLH = Q137) %>%
  rename(LRHH = Q139) %>%
  rename(HRLH = Q140) %>%
  rename(HRHH = Q141)

```

Next i want to remove variables I don't need for my analysis. That includes everything except for the sociaty ratings ("LFLH" and so on) and the political ideology measures


```{r removingvariables}
ideal_society_simplified <- ideal_society_clean %>%
  select(LFLH,
         LFHH,
         HFLH,
         HFHH,
         LRLH,
         LRHH,
         HRLH,
         HRHH,
         Q2,
         Q26,
         Q27,
         Q28,
         poli_ori)
```

Now that it is just the simplified data, i want to zscore the political orientation measures.

```{r zscore_polori}

ideal_society_simplified$Q2 <- as.numeric(ideal_society_simplified$Q2)
ideal_society_simplified$Q26 <- as.numeric(ideal_society_simplified$Q26)
ideal_society_simplified$Q27 <- as.numeric(ideal_society_simplified$Q27)
ideal_society_simplified$Q28 <- as.numeric(ideal_society_simplified$Q28)

ideal_society_simplified <- ideal_society_simplified %>%
  mutate(z_pol_ori = scale(Q2)) %>%
  mutate(z_pol_part_pref = scale(Q26)) %>%
  mutate(z_econ_descr = scale(Q27)) %>%
  mutate(z_soc_iss = scale(Q28))
  
```

```{r aveargepoliori}
ideal_society_simplified <- ideal_society_simplified %>%  
  mutate(avrg_pol_score = rowMeans(select(ideal_society_simplified, z_pol_ori, z_pol_part_pref, z_econ_descr, z_soc_iss), na.rm = TRUE))


```

```{r newdataset}

ideal_society_avrgpoli <- ideal_society_simplified %>%
  select(LFLH,
         LFHH,
         HFLH,
         HFHH,
         LRLH,
         LRHH,
         HRLH,
         HRHH,
         avrg_pol_score)

```

Now to go from wide to long

```{r pain}
ideal_society_avrgpoli <- ideal_society_avrgpoli %>%
mutate(Subject = row_number())

```

```{r }
long_ideal_society <- ideal_society_avrgpoli %>%
 pivot_longer(
    cols = c(LFLH, LFHH, HFLH, HFHH, LRLH, LRHH, HRLH, HRHH),
    names_to = "Rating_Type",
    values_to = "Society_Rating"
  ) %>%
  mutate(
    Family_Values = ifelse(str_detect(Rating_Type, "LF"), 0, 
                           ifelse(str_detect(Rating_Type, "HF"), 1, NA)),
    Religion = ifelse(str_detect(Rating_Type, "LR"), 0, 
                      ifelse(str_detect(Rating_Type, "HR"), 1, NA)),
    Happiness = ifelse(str_detect(Rating_Type, "LH"), 0, 
                       ifelse(str_detect(Rating_Type, "HH"), 1, NA))
  ) %>%
  select(Subject, Society_Rating, Family_Values, Religion, Happiness, avrg_pol_score)

```

```{r regression}



long_ideal_society$Society_Rating <- as.numeric(long_ideal_society$Society_Rating)



family_mixedmodel <- lmer(Society_Rating ~ avrg_pol_score * Happiness * Family_Values + 
                          (1 | Subject), 
                          data = long_ideal_society %>% filter(!is.na(Family_Values)))
                            

summary(family_mixedmodel)

```

```{r rsqaured}

r.squaredGLMM(family_mixedmodel)

```